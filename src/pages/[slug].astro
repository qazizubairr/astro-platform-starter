---
import fs from 'fs/promises';
import path from 'path';
import { marked } from 'marked';

export async function getStaticPaths() {
  const files = await fs.readdir('content/pages');
  
  return files
    .filter(file => file.endsWith('.json'))
    .map(file => {
      const slug = file.replace('.json', '');
      return { params: { slug } };
    });
}

const { slug } = Astro.params;

const filePath = path.resolve('content/pages', `${slug}.json`);
let pageData;

try {
  const file = await fs.readFile(filePath, 'utf-8');
  pageData = JSON.parse(file);
} catch (e) {
  throw new Error(`Page not found for slug: ${slug}`);
}
---

<html lang="en">
  <head>
    <title>{pageData.title}</title>
  </head>
  <body>
    <main>
      <h1>{pageData.title}</h1>
      <article set:html={marked.parse(pageData.markdown_content)} />
    </main>
  </body>
</html>
